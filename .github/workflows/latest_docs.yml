# .github/workflows/latest_docs.yml

name: Documentation Build

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  build_docs:
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'
    - name: Install R and dependencies
      uses: r-lib/actions/setup-r@v2
      with:
        r-version: '4.3'

    - name: Install R dependencies
      run: |
        Rscript -e "install.packages(c('nnTensor'))"
        
    - name: Install Python dependencies
      run: |
        pip install .[docs]

    - name: Clean up and Free Disk Space ðŸ§¹
      run: |
        rm -rf node_modules
        rm -rf ~/.cache/pip
        pip cache purge || true
    - name: Build Sphinx Documentation
      run: |
        sphinx-build -b html docs _build/html

    - name: Deploy documentation to Read the Docs
      uses: readthedocs/actions/preview@v1
      with:
        project_slug: imml
        version_slug: latest
        path: _build/html
        token: ${{ secrets.RTD_TOKEN }}