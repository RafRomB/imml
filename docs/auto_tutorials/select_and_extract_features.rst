
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_tutorials/select_and_extract_features.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_tutorials_select_and_extract_features.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_tutorials_select_and_extract_features.py:


======================================================================================
Dimensionality reduction: Feature extraction and feature selection
======================================================================================

High-dimensional datasets can severely impact machine learning projects, by increasing computational demands,
data-adquisition costs and reducing model interpretability. It can also degrade performance due to the curse
of dimensionality, as well as the presence of correlated, noisy, or irrelevant features. Consequently, reducing the
number of features is often critical. Dimensionality reduction addresses these challenges by enhancing
computational efficiency, highlighting key features, reducing noise, and enabling better data visualization.

Dimensionality reduction refers to two main approaches: feature selection and feature extraction.
- Feature selection identifies the most relevant features from the dataset.
- Feature extraction creates new features by transforming the original ones to capture essential information.

In this tutorial, you will learn how to use ``JNMF`` for both feature selection and feature extraction. We will also
cover how to work with missing data, infer modality importance, and visualize the contributions of the top features.

What you will learn:

- How to represent your multi-modal dataset as Xs (a list of data matrices).
- How to apply ``JNMF`` for multi-modal feature extraction.
- How to apply ``JNMFFeatureSelector`` for multi-modal feature selection.
- How to handle missing values.
- How to assess modality importance and inspect the selected top features.
- How to benchmark different dimensionality-reduction strategies.

.. GENERATED FROM PYTHON SOURCE LINES 29-33

.. code-block:: Python


    # License: BSD 3-Clause License









.. GENERATED FROM PYTHON SOURCE LINES 34-38

Step 0: Prerequisites
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
To run this tutorial, install the extra dependencies:
  pip install imml[r]

.. GENERATED FROM PYTHON SOURCE LINES 41-43

Step 1: Import required libraries
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. GENERATED FROM PYTHON SOURCE LINES 43-61

.. code-block:: Python


    from sklearn.datasets import make_classification
    from sklearn.impute import SimpleImputer
    from sklearn.pipeline import make_pipeline
    from sklearn.preprocessing import MinMaxScaler
    import pandas as pd
    import numpy as np
    from sklearn.svm import SVC
    from sklearn.preprocessing import FunctionTransformer
    from sklearn.metrics import accuracy_score
    import matplotlib.patches as mpatches

    from imml.decomposition import JNMF
    from imml.preprocessing import MultiModTransformer, ConcatenateMods
    from imml.ampute import Amputer
    from imml.feature_selection import JNMFFeatureSelector









.. GENERATED FROM PYTHON SOURCE LINES 62-64

Step 2: Define plotting functions
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. GENERATED FROM PYTHON SOURCE LINES 64-100

.. code-block:: Python


    def get_modality_importance(Xs, selected_features, weights, names):
        selected_features = {"Feature": selected_features, "Feature Importance": weights}
        selected_features = pd.DataFrame(selected_features)
        selected_features = selected_features.sort_values(by="Feature Importance",
                                                          ascending=False)
        selected_features["Modality"] = selected_features["Feature"].apply(
            lambda x: [name for X,name in zip(Xs, names) if x in X.columns][0])
        selected_features = selected_features.groupby("Modality")["Feature Importance"].sum()
        selected_features = selected_features.div(selected_features.sum()).mul(100)
        selected_features = selected_features.sort_values(ascending=False)
        return selected_features

    def get_top_features(Xs, selected_features, weights, components, names):
        selected_features = {"Feature": selected_features, "Feature Importance": weights,
                             "Component": components}
        selected_features = pd.DataFrame(selected_features)
        selected_features = selected_features.sort_values(by="Feature Importance",
                                                          ascending=False)
        selected_features["Modality"] = selected_features["Feature"].apply(
            lambda x: [name for X,name in zip(Xs, names) if x in X.columns][0])
        selected_features["Component"] += 1
        return selected_features

    def get_contributions(Xs, selected_features, weights, components, names):
        selected_features = {"Feature": selected_features, "Feature Importance": weights,
                             "Component": components}
        selected_features = pd.DataFrame(selected_features)
        selected_features = selected_features.sort_values(by=["Component", "Feature Importance"],
                                                          ascending=[True, False])
        selected_features["Modality"] = selected_features["Feature"].apply(
            lambda x: [name for X,name in zip(Xs, names) if x in X.columns][0])
        selected_features["Component"] += 1
        return selected_features









.. GENERATED FROM PYTHON SOURCE LINES 101-111

Step 3: Load the dataset
^^^^^^^^^^^^^^^^^^^^^^^^
For reproducibility, we generate a small synthetic classification dataset and split the features into two
modalities (Xs[0], Xs[1]).

Using your own data:

- Represent your dataset as a Python list Xs, one entry per modality.
- Each Xs[i] should be a 2D array-like (pandas DataFrame or NumPy array) of shape (n_samples, n_features_i).
- All modalities must refer to the same samples and be aligned by row.

.. GENERATED FROM PYTHON SOURCE LINES 111-123

.. code-block:: Python


    random_state = 42
    X, y = make_classification(n_samples=50, random_state=random_state, n_clusters_per_class=1, n_classes=3)
    X, y = pd.DataFrame(X), pd.Series(y)
    X.columns = X.columns.astype(str)
    # Two modalities: first 10 features and last 10 features
    Xs = [X.iloc[:, :10], X.iloc[:, 10:]]
    names= ["Modality A", "Modality B"]
    print("Samples:", len(Xs[0]), "\t", "Modalities:", len(Xs), "\t", "Features:", [X.shape[1] for X in Xs])
    n_clusters = len(np.unique(y))
    y.value_counts()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Samples: 50      Modalities: 2   Features: [10, 10]

    0    17
    1    17
    2    16
    Name: count, dtype: int64



.. GENERATED FROM PYTHON SOURCE LINES 124-126

Step 4: Apply feature selection and feature extraction
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

.. GENERATED FROM PYTHON SOURCE LINES 126-138

.. code-block:: Python


    n_components = 4
    # Feature extraction
    pipeline = make_pipeline(MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                             JNMF(n_components=n_components, random_state=random_state))
    pipeline.fit(Xs)

    # Feature selection
    pipeline = make_pipeline(MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                             JNMFFeatureSelector(n_components=n_components, random_state=random_state))
    pipeline.fit(Xs)






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <style>#sk-container-id-1 {
      /* Definition of color scheme common for light and dark mode */
      --sklearn-color-text: #000;
      --sklearn-color-text-muted: #666;
      --sklearn-color-line: gray;
      /* Definition of color scheme for unfitted estimators */
      --sklearn-color-unfitted-level-0: #fff5e6;
      --sklearn-color-unfitted-level-1: #f6e4d2;
      --sklearn-color-unfitted-level-2: #ffe0b3;
      --sklearn-color-unfitted-level-3: chocolate;
      /* Definition of color scheme for fitted estimators */
      --sklearn-color-fitted-level-0: #f0f8ff;
      --sklearn-color-fitted-level-1: #d4ebff;
      --sklearn-color-fitted-level-2: #b3dbfd;
      --sklearn-color-fitted-level-3: cornflowerblue;

      /* Specific color for light theme */
      --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
      --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
      --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
      --sklearn-color-icon: #696969;

      @media (prefers-color-scheme: dark) {
        /* Redefinition of color scheme for dark theme */
        --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
        --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
        --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
        --sklearn-color-icon: #878787;
      }
    }

    #sk-container-id-1 {
      color: var(--sklearn-color-text);
    }

    #sk-container-id-1 pre {
      padding: 0;
    }

    #sk-container-id-1 input.sk-hidden--visually {
      border: 0;
      clip: rect(1px 1px 1px 1px);
      clip: rect(1px, 1px, 1px, 1px);
      height: 1px;
      margin: -1px;
      overflow: hidden;
      padding: 0;
      position: absolute;
      width: 1px;
    }

    #sk-container-id-1 div.sk-dashed-wrapped {
      border: 1px dashed var(--sklearn-color-line);
      margin: 0 0.4em 0.5em 0.4em;
      box-sizing: border-box;
      padding-bottom: 0.4em;
      background-color: var(--sklearn-color-background);
    }

    #sk-container-id-1 div.sk-container {
      /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
         but bootstrap.min.css set `[hidden] { display: none !important; }`
         so we also need the `!important` here to be able to override the
         default hidden behavior on the sphinx rendered scikit-learn.org.
         See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
      display: inline-block !important;
      position: relative;
    }

    #sk-container-id-1 div.sk-text-repr-fallback {
      display: none;
    }

    div.sk-parallel-item,
    div.sk-serial,
    div.sk-item {
      /* draw centered vertical line to link estimators */
      background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
      background-size: 2px 100%;
      background-repeat: no-repeat;
      background-position: center center;
    }

    /* Parallel-specific style estimator block */

    #sk-container-id-1 div.sk-parallel-item::after {
      content: "";
      width: 100%;
      border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
      flex-grow: 1;
    }

    #sk-container-id-1 div.sk-parallel {
      display: flex;
      align-items: stretch;
      justify-content: center;
      background-color: var(--sklearn-color-background);
      position: relative;
    }

    #sk-container-id-1 div.sk-parallel-item {
      display: flex;
      flex-direction: column;
    }

    #sk-container-id-1 div.sk-parallel-item:first-child::after {
      align-self: flex-end;
      width: 50%;
    }

    #sk-container-id-1 div.sk-parallel-item:last-child::after {
      align-self: flex-start;
      width: 50%;
    }

    #sk-container-id-1 div.sk-parallel-item:only-child::after {
      width: 0;
    }

    /* Serial-specific style estimator block */

    #sk-container-id-1 div.sk-serial {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: var(--sklearn-color-background);
      padding-right: 1em;
      padding-left: 1em;
    }


    /* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
    clickable and can be expanded/collapsed.
    - Pipeline and ColumnTransformer use this feature and define the default style
    - Estimators will overwrite some part of the style using the `sk-estimator` class
    */

    /* Pipeline and ColumnTransformer style (default) */

    #sk-container-id-1 div.sk-toggleable {
      /* Default theme specific background. It is overwritten whether we have a
      specific estimator or a Pipeline/ColumnTransformer */
      background-color: var(--sklearn-color-background);
    }

    /* Toggleable label */
    #sk-container-id-1 label.sk-toggleable__label {
      cursor: pointer;
      display: flex;
      width: 100%;
      margin-bottom: 0;
      padding: 0.5em;
      box-sizing: border-box;
      text-align: center;
      align-items: start;
      justify-content: space-between;
      gap: 0.5em;
    }

    #sk-container-id-1 label.sk-toggleable__label .caption {
      font-size: 0.6rem;
      font-weight: lighter;
      color: var(--sklearn-color-text-muted);
    }

    #sk-container-id-1 label.sk-toggleable__label-arrow:before {
      /* Arrow on the left of the label */
      content: "▸";
      float: left;
      margin-right: 0.25em;
      color: var(--sklearn-color-icon);
    }

    #sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
      color: var(--sklearn-color-text);
    }

    /* Toggleable content - dropdown */

    #sk-container-id-1 div.sk-toggleable__content {
      display: none;
      text-align: left;
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-0);
    }

    #sk-container-id-1 div.sk-toggleable__content.fitted {
      /* fitted */
      background-color: var(--sklearn-color-fitted-level-0);
    }

    #sk-container-id-1 div.sk-toggleable__content pre {
      margin: 0.2em;
      border-radius: 0.25em;
      color: var(--sklearn-color-text);
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-0);
    }

    #sk-container-id-1 div.sk-toggleable__content.fitted pre {
      /* unfitted */
      background-color: var(--sklearn-color-fitted-level-0);
    }

    #sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
      /* Expand drop-down */
      display: block;
      width: 100%;
      overflow: visible;
    }

    #sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
      content: "▾";
    }

    /* Pipeline/ColumnTransformer-specific style */

    #sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
      color: var(--sklearn-color-text);
      background-color: var(--sklearn-color-unfitted-level-2);
    }

    #sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
      background-color: var(--sklearn-color-fitted-level-2);
    }

    /* Estimator-specific style */

    /* Colorize estimator box */
    #sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-2);
    }

    #sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
      /* fitted */
      background-color: var(--sklearn-color-fitted-level-2);
    }

    #sk-container-id-1 div.sk-label label.sk-toggleable__label,
    #sk-container-id-1 div.sk-label label {
      /* The background is the default theme color */
      color: var(--sklearn-color-text-on-default-background);
    }

    /* On hover, darken the color of the background */
    #sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
      color: var(--sklearn-color-text);
      background-color: var(--sklearn-color-unfitted-level-2);
    }

    /* Label box, darken color on hover, fitted */
    #sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
      color: var(--sklearn-color-text);
      background-color: var(--sklearn-color-fitted-level-2);
    }

    /* Estimator label */

    #sk-container-id-1 div.sk-label label {
      font-family: monospace;
      font-weight: bold;
      display: inline-block;
      line-height: 1.2em;
    }

    #sk-container-id-1 div.sk-label-container {
      text-align: center;
    }

    /* Estimator-specific */
    #sk-container-id-1 div.sk-estimator {
      font-family: monospace;
      border: 1px dotted var(--sklearn-color-border-box);
      border-radius: 0.25em;
      box-sizing: border-box;
      margin-bottom: 0.5em;
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-0);
    }

    #sk-container-id-1 div.sk-estimator.fitted {
      /* fitted */
      background-color: var(--sklearn-color-fitted-level-0);
    }

    /* on hover */
    #sk-container-id-1 div.sk-estimator:hover {
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-2);
    }

    #sk-container-id-1 div.sk-estimator.fitted:hover {
      /* fitted */
      background-color: var(--sklearn-color-fitted-level-2);
    }

    /* Specification for estimator info (e.g. "i" and "?") */

    /* Common style for "i" and "?" */

    .sk-estimator-doc-link,
    a:link.sk-estimator-doc-link,
    a:visited.sk-estimator-doc-link {
      float: right;
      font-size: smaller;
      line-height: 1em;
      font-family: monospace;
      background-color: var(--sklearn-color-background);
      border-radius: 1em;
      height: 1em;
      width: 1em;
      text-decoration: none !important;
      margin-left: 0.5em;
      text-align: center;
      /* unfitted */
      border: var(--sklearn-color-unfitted-level-1) 1pt solid;
      color: var(--sklearn-color-unfitted-level-1);
    }

    .sk-estimator-doc-link.fitted,
    a:link.sk-estimator-doc-link.fitted,
    a:visited.sk-estimator-doc-link.fitted {
      /* fitted */
      border: var(--sklearn-color-fitted-level-1) 1pt solid;
      color: var(--sklearn-color-fitted-level-1);
    }

    /* On hover */
    div.sk-estimator:hover .sk-estimator-doc-link:hover,
    .sk-estimator-doc-link:hover,
    div.sk-label-container:hover .sk-estimator-doc-link:hover,
    .sk-estimator-doc-link:hover {
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-3);
      color: var(--sklearn-color-background);
      text-decoration: none;
    }

    div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
    .sk-estimator-doc-link.fitted:hover,
    div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
    .sk-estimator-doc-link.fitted:hover {
      /* fitted */
      background-color: var(--sklearn-color-fitted-level-3);
      color: var(--sklearn-color-background);
      text-decoration: none;
    }

    /* Span, style for the box shown on hovering the info icon */
    .sk-estimator-doc-link span {
      display: none;
      z-index: 9999;
      position: relative;
      font-weight: normal;
      right: .2ex;
      padding: .5ex;
      margin: .5ex;
      width: min-content;
      min-width: 20ex;
      max-width: 50ex;
      color: var(--sklearn-color-text);
      box-shadow: 2pt 2pt 4pt #999;
      /* unfitted */
      background: var(--sklearn-color-unfitted-level-0);
      border: .5pt solid var(--sklearn-color-unfitted-level-3);
    }

    .sk-estimator-doc-link.fitted span {
      /* fitted */
      background: var(--sklearn-color-fitted-level-0);
      border: var(--sklearn-color-fitted-level-3);
    }

    .sk-estimator-doc-link:hover span {
      display: block;
    }

    /* "?"-specific style due to the `<a>` HTML tag */

    #sk-container-id-1 a.estimator_doc_link {
      float: right;
      font-size: 1rem;
      line-height: 1em;
      font-family: monospace;
      background-color: var(--sklearn-color-background);
      border-radius: 1rem;
      height: 1rem;
      width: 1rem;
      text-decoration: none;
      /* unfitted */
      color: var(--sklearn-color-unfitted-level-1);
      border: var(--sklearn-color-unfitted-level-1) 1pt solid;
    }

    #sk-container-id-1 a.estimator_doc_link.fitted {
      /* fitted */
      border: var(--sklearn-color-fitted-level-1) 1pt solid;
      color: var(--sklearn-color-fitted-level-1);
    }

    /* On hover */
    #sk-container-id-1 a.estimator_doc_link:hover {
      /* unfitted */
      background-color: var(--sklearn-color-unfitted-level-3);
      color: var(--sklearn-color-background);
      text-decoration: none;
    }

    #sk-container-id-1 a.estimator_doc_link.fitted:hover {
      /* fitted */
      background-color: var(--sklearn-color-fitted-level-3);
    }

    .estimator-table summary {
        padding: .5rem;
        font-family: monospace;
        cursor: pointer;
    }

    .estimator-table details[open] {
        padding-left: 0.1rem;
        padding-right: 0.1rem;
        padding-bottom: 0.3rem;
    }

    .estimator-table .parameters-table {
        margin-left: auto !important;
        margin-right: auto !important;
    }

    .estimator-table .parameters-table tr:nth-child(odd) {
        background-color: #fff;
    }

    .estimator-table .parameters-table tr:nth-child(even) {
        background-color: #f6f6f6;
    }

    .estimator-table .parameters-table tr:hover {
        background-color: #e0e0e0;
    }

    .estimator-table table td {
        border: 1px solid rgba(106, 105, 104, 0.232);
    }

    .user-set td {
        color:rgb(255, 94, 0);
        text-align: left;
    }

    .user-set td.value pre {
        color:rgb(255, 94, 0) !important;
        background-color: transparent !important;
    }

    .default td {
        color: black;
        text-align: left;
    }

    .user-set td i,
    .default td i {
        color: black;
    }

    .copy-paste-icon {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);
        background-repeat: no-repeat;
        background-size: 14px 14px;
        background-position: 0;
        display: inline-block;
        width: 14px;
        height: 14px;
        cursor: pointer;
    }
    </style><body><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;multimodtransformer&#x27;,
                     MultiModTransformer(transformer=MinMaxScaler())),
                    (&#x27;jnmffeatureselector&#x27;, JNMFFeatureSelector())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted" data-param-prefix="">
            <div class="estimator-table">
                <details>
                    <summary>Parameters</summary>
                    <table class="parameters-table">
                      <tbody>
                    
            <tr class="user-set">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('steps',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">steps&nbsp;</td>
                <td class="value">[(&#x27;multimodtransformer&#x27;, ...), (&#x27;jnmffeatureselector&#x27;, ...)]</td>
            </tr>
    

            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('transform_input',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">transform_input&nbsp;</td>
                <td class="value">None</td>
            </tr>
    

            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('memory',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">memory&nbsp;</td>
                <td class="value">None</td>
            </tr>
    

            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('verbose',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">verbose&nbsp;</td>
                <td class="value">False</td>
            </tr>
    
                      </tbody>
                    </table>
                </details>
            </div>
        </div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>multimodtransformer: MultiModTransformer</div></div></label><div class="sk-toggleable__content fitted" data-param-prefix="multimodtransformer__">
            <div class="estimator-table">
                <details>
                    <summary>Parameters</summary>
                    <table class="parameters-table">
                      <tbody>
                    
            <tr class="user-set">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('transformer',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">transformer&nbsp;</td>
                <td class="value">MinMaxScaler()</td>
            </tr>
    
                      </tbody>
                    </table>
                </details>
            </div>
        </div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>transformer: MinMaxScaler</div></div></label><div class="sk-toggleable__content fitted" data-param-prefix="multimodtransformer__transformer__"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>MinMaxScaler</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.7/modules/generated/sklearn.preprocessing.MinMaxScaler.html">?<span>Documentation for MinMaxScaler</span></a></div></label><div class="sk-toggleable__content fitted" data-param-prefix="multimodtransformer__transformer__">
            <div class="estimator-table">
                <details>
                    <summary>Parameters</summary>
                    <table class="parameters-table">
                      <tbody>
                    
            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('feature_range',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">feature_range&nbsp;</td>
                <td class="value">(0, ...)</td>
            </tr>
    

            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('copy',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">copy&nbsp;</td>
                <td class="value">True</td>
            </tr>
    

            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('clip',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">clip&nbsp;</td>
                <td class="value">False</td>
            </tr>
    
                      </tbody>
                    </table>
                </details>
            </div>
        </div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>JNMFFeatureSelector</div></div></label><div class="sk-toggleable__content fitted" data-param-prefix="jnmffeatureselector__">
            <div class="estimator-table">
                <details>
                    <summary>Parameters</summary>
                    <table class="parameters-table">
                      <tbody>
                    
            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('select_by',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">select_by&nbsp;</td>
                <td class="value">&#x27;component&#x27;</td>
            </tr>
    

            <tr class="default">
                <td><i class="copy-paste-icon"
                     onclick="copyToClipboard('f_per_component',
                              this.parentElement.nextElementSibling)"
                ></i></td>
                <td class="param">f_per_component&nbsp;</td>
                <td class="value">1</td>
            </tr>
    
                      </tbody>
                    </table>
                </details>
            </div>
        </div></div></div></div></div></div></div><script>function copyToClipboard(text, element) {
        // Get the parameter prefix from the closest toggleable content
        const toggleableContent = element.closest('.sk-toggleable__content');
        const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
        const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;

        const originalStyle = element.style;
        const computedStyle = window.getComputedStyle(element);
        const originalWidth = computedStyle.width;
        const originalHTML = element.innerHTML.replace('Copied!', '');

        navigator.clipboard.writeText(fullParamName)
            .then(() => {
                element.style.width = originalWidth;
                element.style.color = 'green';
                element.innerHTML = "Copied!";

                setTimeout(() => {
                    element.innerHTML = originalHTML;
                    element.style = originalStyle;
                }, 2000);
            })
            .catch(err => {
                console.error('Failed to copy:', err);
                element.style.color = 'red';
                element.innerHTML = "Failed!";
                setTimeout(() => {
                    element.innerHTML = originalHTML;
                    element.style = originalStyle;
                }, 2000);
            });
        return false;
    }

    document.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {
        const toggleableContent = element.closest('.sk-toggleable__content');
        const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';
        const paramName = element.parentElement.nextElementSibling.textContent.trim();
        const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;

        element.setAttribute('title', fullParamName);
    });
    </script></body>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 139-140

We can identify and visualize the selected features.

.. GENERATED FROM PYTHON SOURCE LINES 140-145

.. code-block:: Python

    selected_features = get_top_features(Xs=Xs, selected_features= pipeline[-1].selected_features_,
                                         weights= pipeline[-1].weights_, components= pipeline[-1].component_,
                                         names=names)
    selected_features






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Feature</th>
          <th>Feature Importance</th>
          <th>Component</th>
          <th>Modality</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>11</td>
          <td>3.760145</td>
          <td>4</td>
          <td>Modality B</td>
        </tr>
        <tr>
          <th>1</th>
          <td>3</td>
          <td>3.654930</td>
          <td>3</td>
          <td>Modality A</td>
        </tr>
        <tr>
          <th>2</th>
          <td>4</td>
          <td>3.220185</td>
          <td>2</td>
          <td>Modality A</td>
        </tr>
        <tr>
          <th>3</th>
          <td>2</td>
          <td>3.083059</td>
          <td>1</td>
          <td>Modality A</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 146-157

.. code-block:: Python

    palette = {mod:col for mod, col in zip(names, ["#2ca25f", "#99d8c9"])}
    palette_list = [palette[mod] for mod in selected_features["Modality"]]
    selected_features = selected_features.assign(color= palette_list).sort_values("Feature Importance")
    ax = selected_features.plot(
        kind="barh", x="Feature", y="Feature Importance", legend=False,
        color=selected_features["color"], xlabel="Feature Importance",
        xlim=(0,selected_features["Feature Importance"].max() + .8)
    )
    ax = ax.legend(handles=[mpatches.Patch(color=color, label=modality) for modality, color in palette.items()],
                   loc="lower right")




.. image-sg:: /auto_tutorials/images/sphx_glr_select_and_extract_features_001.png
   :alt: select and extract features
   :srcset: /auto_tutorials/images/sphx_glr_select_and_extract_features_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 158-159

The top features include attributes from both modalities, but Modality A appears to be more important overall.

.. GENERATED FROM PYTHON SOURCE LINES 161-162

We can visualize the modality relative importance with a barplot.

.. GENERATED FROM PYTHON SOURCE LINES 162-168

.. code-block:: Python

    selected_features = get_modality_importance(
        Xs=Xs, selected_features= pipeline[-1].selected_features_,
        weights= pipeline[-1].weights_, names=names)
    selected_features.to_frame()

    ax = selected_features.plot(kind= "bar", color= list(palette.values()), ylabel= "Modality Importance (\%)", rot=0)



.. image-sg:: /auto_tutorials/images/sphx_glr_select_and_extract_features_002.png
   :alt: select and extract features
   :srcset: /auto_tutorials/images/sphx_glr_select_and_extract_features_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 169-170

Yes, in fact Modality A is the most important modality in this example.

.. GENERATED FROM PYTHON SOURCE LINES 172-173

We can also extract features and visualize the original features with the largest contribution to the components.

.. GENERATED FROM PYTHON SOURCE LINES 173-183

.. code-block:: Python


    pipeline = make_pipeline(MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                             JNMFFeatureSelector(n_components = n_components, select_by="component",
                                                 random_state=42, f_per_component=2))
    pipeline.fit(Xs)
    selected_features = get_contributions(Xs=Xs, selected_features= pipeline[-1].selected_features_,
                                         weights= pipeline[-1].weights_, components= pipeline[-1].component_,
                                         names= names)
    selected_features






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Feature</th>
          <th>Feature Importance</th>
          <th>Component</th>
          <th>Modality</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>3</th>
          <td>2</td>
          <td>3.083059</td>
          <td>1</td>
          <td>Modality A</td>
        </tr>
        <tr>
          <th>7</th>
          <td>6</td>
          <td>2.511698</td>
          <td>1</td>
          <td>Modality A</td>
        </tr>
        <tr>
          <th>2</th>
          <td>4</td>
          <td>3.220185</td>
          <td>2</td>
          <td>Modality A</td>
        </tr>
        <tr>
          <th>5</th>
          <td>12</td>
          <td>3.211047</td>
          <td>2</td>
          <td>Modality B</td>
        </tr>
        <tr>
          <th>1</th>
          <td>3</td>
          <td>3.654930</td>
          <td>3</td>
          <td>Modality A</td>
        </tr>
        <tr>
          <th>6</th>
          <td>15</td>
          <td>2.932770</td>
          <td>3</td>
          <td>Modality B</td>
        </tr>
        <tr>
          <th>0</th>
          <td>11</td>
          <td>3.760145</td>
          <td>4</td>
          <td>Modality B</td>
        </tr>
        <tr>
          <th>4</th>
          <td>8</td>
          <td>3.395243</td>
          <td>4</td>
          <td>Modality A</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 184-196

.. code-block:: Python


    palette_list = [palette[mod] for mod in selected_features["Modality"]]
    selected_features = selected_features.assign(color= palette_list).sort_values("Feature Importance")
    ax = selected_features.plot(
        kind="barh", x="Component", y="Feature Importance", legend=False,
        color=selected_features["color"], xlabel="Feature Importance", width=0.9,
        xlim=(0,selected_features["Feature Importance"].max() + .8)
    )
    ax.legend(handles=[mpatches.Patch(color=color, label=modality) for modality, color in palette.items()],
              loc="lower right")
    ax.bar_label(ax.containers[0], labels=selected_features["Feature"], padding = 3)




.. image-sg:: /auto_tutorials/images/sphx_glr_select_and_extract_features_003.png
   :alt: select and extract features
   :srcset: /auto_tutorials/images/sphx_glr_select_and_extract_features_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    [Text(3, 0, '6'), Text(3, 0, '15'), Text(3, 0, '2'), Text(3, 0, '12'), Text(3, 0, '4'), Text(3, 0, '8'), Text(3, 0, '3'), Text(3, 0, '11')]



.. GENERATED FROM PYTHON SOURCE LINES 197-204

Step 6: Analyzing an incomplete multi-modal dataset
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
We simulated block- and feature-wise missing data. To provide comparative benchmarks, we included baselines using
randomly selected features and all available features. The outputs from these methods were then used as inputs for a
support vector machine to predict the ground-truth labels. As the feature selection process does not replace missing
values, an imputation step was applied prior the classification. We repeat the analysis 5 times with different
seeds to have robust results.

.. GENERATED FROM PYTHON SOURCE LINES 204-272

.. code-block:: Python


    ps = np.arange(0., 1., 0.2)
    n_times = 5
    methods = ["No prior imputation", "Baseline imputation"]
    algorithms = ["Feature extraction", "Feature selection", "Randomly selected features", "All features"]
    all_metrics = []

    for algorithm in algorithms:
        for p in ps:
            for i in range(n_times):
                ampute = True
                while ampute: # avoid those iterations where a sample has no available data
                    Xs_train = Amputer(p=p, random_state=i).fit_transform(Xs)
                    for X in Xs_train:
                        mask = np.random.default_rng(i).choice([True, False], p= [p,1-p], size = X.shape)
                        X.iloc[mask] = np.nan
                    if pd.concat(Xs_train, axis=1).isna().all(axis=1).any():
                        i += n_times
                    else:
                        ampute = False
                if algorithm == "Feature extraction":
                    pipeline = make_pipeline(
                        MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                        JNMF(n_components = n_components, random_state=i),
                    )
                elif algorithm == "Feature selection":
                    pipeline = make_pipeline(
                        MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                        JNMFFeatureSelector(n_components = n_components, random_state=i),
                        ConcatenateMods(),
                        SimpleImputer(),
                    )
                elif algorithm == "Randomly selected features":
                    pipeline = make_pipeline(
                        MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                        ConcatenateMods(),
                        SimpleImputer().set_output(transform="pandas"),
                        FunctionTransformer(lambda x:
                                            x.iloc[:,np.random.default_rng(i).integers(
                                                0, sum([X.shape[1] for X in Xs_train]), size= n_components)]),
                     )
                elif algorithm == "All features":
                    pipeline = make_pipeline(
                        MultiModTransformer(MinMaxScaler().set_output(transform="pandas")),
                        ConcatenateMods(),
                        SimpleImputer().set_output(transform="pandas"),
                     )
                transformed_X = pipeline.fit_transform(Xs_train)
                preds = SVC(random_state=i).fit(transformed_X, y).predict(transformed_X)
                metric = accuracy_score(y_pred=preds, y_true=y)
                result = {
                    "Method": algorithm,
                    'Missing rate (%)': int(p*100),
                    "Iteration": i,
                    "Accuracy": metric,
                }
                all_metrics.append(result)

    df = pd.DataFrame(all_metrics)
    df['Method'] = pd.Categorical(
        df['Method'],
        categories=["Feature extraction", "Feature selection", "All features", "Randomly selected features"],
        ordered=True
    )
    df = df.sort_values(["Method", "Missing rate (%)", "Iteration"], ascending=[True, True, True])
    print(df.shape)
    df.head()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    (100, 4)


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Method</th>
          <th>Missing rate (%)</th>
          <th>Iteration</th>
          <th>Accuracy</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>Feature extraction</td>
          <td>0</td>
          <td>0</td>
          <td>0.86</td>
        </tr>
        <tr>
          <th>1</th>
          <td>Feature extraction</td>
          <td>0</td>
          <td>1</td>
          <td>0.82</td>
        </tr>
        <tr>
          <th>2</th>
          <td>Feature extraction</td>
          <td>0</td>
          <td>2</td>
          <td>0.78</td>
        </tr>
        <tr>
          <th>3</th>
          <td>Feature extraction</td>
          <td>0</td>
          <td>3</td>
          <td>0.84</td>
        </tr>
        <tr>
          <th>4</th>
          <td>Feature extraction</td>
          <td>0</td>
          <td>4</td>
          <td>0.78</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 273-274

Let's now visualize the results.

.. GENERATED FROM PYTHON SOURCE LINES 274-280

.. code-block:: Python

    g = df.groupby(["Method", "Missing rate (%)"])["Accuracy"]
    stats = g.agg(mean="mean", sem=lambda x: x.std(ddof=1) / np.sqrt(len(x))).reset_index()
    mean_wide = stats.pivot(index="Missing rate (%)", columns="Method", values="mean")
    sem_wide  = stats.pivot(index="Missing rate (%)", columns="Method", values="sem")
    ax = mean_wide.plot(yerr=sem_wide, marker="o", capsize=3, ylabel="Accuracy")




.. image-sg:: /auto_tutorials/images/sphx_glr_select_and_extract_features_004.png
   :alt: select and extract features
   :srcset: /auto_tutorials/images/sphx_glr_select_and_extract_features_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 281-295

Summary of results
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Accuracy degrades as the missing‑data rate increases, as a natural consequence of losing information. Using all
features achieved always the best performance, a result that was expected. Both dimensionality‑reduction strategies
(extraction and selection) perform well when the amount of missing data is not high. Feature extraction with
tends to be more robust than feature selection as missingness increases, often yielding the highest accuracy
among the reduced representations at moderate-to-high missing rates.

Why feature extraction can be more resilient here:

- ``JNMF`` learns low‑rank, shared latent components across modalities, which can attenuate noise introduced by
  missing values.
- The selection pipeline requires imputation after selecting features; simple imputers can inject bias,
  slightly hurting downstream classification in settings with substantial missingness.

.. GENERATED FROM PYTHON SOURCE LINES 297-305

Conclusion
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
In this tutorial we showed how to build compact, informative representations from multi‑modal data and how missingness
affects downstream performance.

Overall, `iMML` provides flexible pipelines to extract or select features across modalities and to benchmark
robustness under missing data, helping you choose the right trade‑off between accuracy, efficiency, and interpretability
for your application.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 17.462 seconds)


.. _sphx_glr_download_auto_tutorials_select_and_extract_features.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: select_and_extract_features.ipynb <select_and_extract_features.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: select_and_extract_features.py <select_and_extract_features.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: select_and_extract_features.zip <select_and_extract_features.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
